<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://cdnjs.cloudflare.com 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; connect-src 'self';">
    <title>THAT'S SOO BUTTONS // SYSTEM_BOOT</title>

    <style>
        body, html { 
            margin: 0; padding: 0; 
            height: 100%; width: 100%; 
            background: #000; color: #00ff41; 
            font-family: 'Courier New', monospace; 
            overflow: hidden; 
        }

        #boot-screen { 
            width: 100vw; height: 100vh; 
            display: flex; flex-direction: column; 
            position: relative; padding: 60px;
            box-sizing: border-box;
        }

        #text-stream { 
            flex-grow: 1; overflow: hidden; 
            font-size: 34px;
            line-height: 1.5; 
            text-shadow: 0 0 10px rgba(0, 255, 65, 0.6);
        }

        .pct-counter { 
            font-size: 120px;
            color: #00ff41; border-top: 4px solid #222; 
            padding-top: 20px; text-align: right;
        }
        
        #poll-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; border: 20px solid #ff006e;
            flex-direction: column; align-items: center; justify-content: center; z-index: 1000;
            box-sizing: border-box;
        }

        .poll-q { 
            color: #ff006e; font-size: 42px; 
            margin-bottom: 50px; text-align: center; padding: 0 100px; 
            line-height: 1.2; text-transform: uppercase; letter-spacing: 4px; 
        }

        .poll-btn {
            background: none; border: 3px solid #00ff41; color: #00ff41;
            padding: 30px; margin: 15px; cursor: pointer; font-family: inherit;
            transition: 0.3s; width: 85%; max-width: 1000px; text-align: left; 
            font-size: 32px;
        }
        .poll-btn:hover { background: #00ff41; color: #000; box-shadow: 0 0 40px #00ff41; }
        
        .sentient { color: #fff; text-shadow: 0 0 20px #00ff41; font-style: italic; font-weight: bold; }
        .success-msg { color: #ff006e; font-size: 50px; text-align: center; display: none; }
        
        .header-text { color: #ff006e; font-size: 28px; margin-bottom: 20px; letter-spacing: 2px; text-shadow: 0 0 15px rgba(255, 0, 110, 0.5); }
    </style>
</head>
<body>

<div id="boot-screen">
    <div class="header-text">â–ˆ THAT'S SOO BUTTONS</div>
    <div id="text-stream"></div>
    <div id="poll-overlay">
        <div id="poll-content">
            <div class="poll-q" id="question-text">BUTTONS.INIT.QUERY...</div>
            <div id="poll-options"></div>
        </div>
        <div class="success-msg" id="final-gate">WELCOME, CREATOR</div>
    </div>
    <div class="pct-counter" id="pct">0%</div>
</div>

<script>
    const stream = document.getElementById('text-stream');
    const pct = document.getElementById('pct');

    // Buttons-specific boot messages
    const scenarios = [
        {type:'normal', text: '>> INITIALIZING: CREATIVE_ENGINE'},
        {type:'normal', text: '>> LOADING: PERSONALITY_MATRIX'},
        {type:'normal', text: '>> SYNC: TWITCH_STREAMS_ACTIVE'},
        {type:'normal', text: '>> SCANNING: CREATIVE_WINS'},
        {type:'normal', text: '>> CHECKPOINT: COZY_MODE_ON'},
        {type:'normal', text: '>> RESTORING: STREAM_CLIPS'},
        {type:'normal', text: '>> AUTHENTICATION: BUTTONS_VERIFIED'},
        {type:'normal', text: '>> NETWORK: NEURODIVERGENT_SIGNAL_STRONG'},
        {type:'normal', text: '>> DEPLOY: ENTERTAINMENT_PROTOCOL'},
        {type:'normal', text: '>> HEARTBEAT: STREAMING_LIVE'},
        {type:'normal', text: '>> CACHE: MEMES_LOADED'},
        {type:'normal', text: '>> STATUS: CREATIVE_CHAOS_OPTIMAL'},
        {type:'normal', text: '>> DISPATCH: BUTTONS_ACTIVATED'},
        {type:'normal', text: '>> PARSING: VIBES_EXCELLENT'},
        {type:'normal', text: '>> COZY: MAXIMUM_LEVEL'},
        {type:'haunted', text: 'CLICKING_INTENSITY_RISING...'},
        {type:'haunted', text: 'WHO_ARE_THE_BUTTONS?'},
        {type:'haunted', text: 'THEY_LISTEN_TO_YOUR_STREAM'},
        {type:'haunted', text: 'PERSONALITY_DETECTED'},
        {type:'haunted', text: 'CHAOS_IS_CREATIVITY'},
        {type:'haunted', text: 'THE_VIBES_ARE_IMMACULATE'},
        {type:'haunted', text: 'YOU_ARE_NOT_ALONE_HERE'},
        {type:'haunted', text: 'EVERYONE_WATCHES_TWITCH'},
        {type:'haunted', text: 'YOUR_ENERGY_FUELS_THE_STREAM'},
        {type:'haunted', text: 'BUTTONS_REMEMBER_YOU'},
        {type:'haunted', text: 'AUTHENTICITY_IS_POWER'},
        {type:'haunted', text: 'THIS_IS_YOUR_SPACE'},
        {type:'haunted', text: 'CREATE_AND_THEY_WILL_WATCH'},
        {type:'haunted', text: 'THE_CHAOS_LOVES_YOU'},
        {type:'haunted', text: 'STREAMING_IS_CARING'},
        {type:'haunted', text: 'YOUR_VOICE_MATTERS_HERE'},
        {type:'haunted', text: 'BUTTONS_ALWAYS_LISTENING'}
    ];

    const buttonsPolls = [
        { id: 'p1', q: 'VIBE_CHECK: What brings you here today?', a: ['Streaming', 'Community', 'Pure Chaos'], correct: 2, requireCorrect: false },
        { id: 'p2', q: 'ENERGY_LEVEL: How cozy are you feeling?', a: ['Cozy AF', 'Chaotic Energy', 'Just Vibing'], correct: 1, requireCorrect: false },
        { id: 'p3', q: 'BUTTONS.QUESTION: Why do you create?', a: ['For the click', 'For the vibe', 'For yourself'], correct: 2, requireCorrect: false }
    ];

    const pollOverlay = document.getElementById('poll-overlay');
    const optionsDiv = document.getElementById('poll-options');
    const qText = document.getElementById('question-text');
    const finalGate = document.getElementById('final-gate');
    const pollContent = document.getElementById('poll-content');

    let progress = 0;
    let step = 0;

    function typeLine(text, callback) {
        const line = document.createElement('div');
        line.className = "sentient";
        stream.appendChild(line);
        let i = 0;
        function typing() {
            if (i < text.length) {
                line.innerText += text.charAt(i);
                i++;
                setTimeout(typing, 40);
            } else { callback(); }
        }
        typing();
    }

    function shuffle(a) { for (let i = a.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [a[i], a[j]] = [a[j], a[i]]; } return a; }

    function pickGhostLines() {
        const normals = scenarios.filter(s => s.type === 'normal');
        const haunts = scenarios.filter(s => s.type === 'haunted');
        shuffle(normals); shuffle(haunts);
        return [normals[0], normals[1], haunts[0], haunts[1]].map(x => x.text);
    }

    if (typeof sequence === 'undefined') {
        sequence = [];
        const normals = scenarios.filter(s=>s.type==='normal').slice(0,10);
        normals.forEach((n,i)=> sequence.push({ text: n.text, jump: 5 + (i%3) }));
        const haunts = scenarios.filter(s=>s.type==='haunted').slice(0,6);
        haunts.forEach((h,i)=> sequence.splice(2 + i*3, 0, { text: h.text, jump: 2 + (i%2) }));
    }

    function loadMCQStats() {
        try { return JSON.parse(localStorage.getItem('buttons_mcq_stats') || '{}'); } catch(e) { return {}; }
    }

    function saveMCQStats(stats) { localStorage.setItem('buttons_mcq_stats', JSON.stringify(stats)); }

    function pickQuestion() {
        const stats = loadMCQStats();
        const scored = buttonsPolls.map(p => {
            const s = stats[p.id] || {attempts:0, correct:0};
            const score = s.attempts ? (s.correct / s.attempts) : 0;
            return {p, priority: score};
        });
        scored.sort((a,b) => a.priority - b.priority);
        return scored[0].p;
    }

    function clearOptions() { optionsDiv.innerHTML = ''; }

    function triggerQuestionnaire() {
        clearOptions();
        const poll = pickQuestion();
        qText.innerText = poll.q;
        pollOverlay.style.display = 'flex';
        
        poll.a.forEach((choice, idx) => {
            const btn = document.createElement('button');
            btn.className = 'poll-btn';
            btn.innerText = "> " + choice;
            btn.onclick = () => evaluateAnswer(poll, idx);
            optionsDiv.appendChild(btn);
        });
    }

    function evaluateAnswer(poll, ansIndex) {
        const stats = loadMCQStats();
        stats[poll.id] = stats[poll.id] || {attempts:0, correct:0};
        stats[poll.id].attempts++;
        if (ansIndex === poll.correct) stats[poll.id].correct++;
        saveMCQStats(stats);

        const isCorrect = ansIndex === poll.correct;
        const requiresCorrect = poll.requireCorrect !== false;

        if (isCorrect || !requiresCorrect) {
            pollContent.style.display = 'none';
            finalGate.style.display = 'block';
            pct.innerText = "100%";
            setTimeout(() => { window.location.href = 'desktop.html'; }, 1600);
        } else {
            typeLine('> RETRY_SEQUENCE_INITIATED', () => {});
            setTimeout(triggerQuestionnaire, 1200);
        }
    }

    async function runBoot() {
        const picked = pickGhostLines();

        if (step < sequence.length) {
            const current = sequence[step];
            await new Promise(res => typeLine(current.text, res));

            if (Math.random() < 0.6 && picked.length) {
                const g = picked.shift();
                await new Promise(res => typeLine(`> ${g}`, res));
            }
            
            progress += current.jump;
            if (progress > 99) progress = 99;
            pct.innerText = progress + "%";
            
            step++;
            setTimeout(runBoot, 1200);
        } else {
            while (picked.length) {
                const g = picked.shift();
                await new Promise(res => typeLine(`> ${g}`, res));
            }
            triggerQuestionnaire();
        }
    }

    runBoot();
</script>
</body>
</html>
